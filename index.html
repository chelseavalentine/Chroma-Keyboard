<!doctype html>
<html>
<head>
  <meta charset="utf-8">

  <script src="../build/tracking-min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

  <style>
  .rect {
    position: absolute;
  }

  #video {
    position: absolute;
  }

  </style>
</head>
<body>
  <div class="demo-title">
    <p><a href="http://trackingjs.com" target="_parent">tracking.js</a> Ôºç detect certain colors in a image</p>
  </div>

  <div class="input-frame">
    <div class="input-container">
        <h2>Input</h2>
          <video src="video.ogv" muted autoplay id="video" loop="loop" width="320" height="180">
        </video>
      </div>
    </div>

    <div class="demo-frame">
      <div class="demo-container">
        <img id="img" src="psmove.png" />
      </div>
    </div>

    <script>
      window.onload = function() {
        var img = document.getElementById('img');
        var inputContainer = document.querySelector('.input-container');

        var vid = document.getElementById('video');

        tracking.ColorTracker.registerColor('green', function(r, g, b) {
          if (r < 50 && g > 200 && b < 50) {
            return true;
          }
          return false;
        });

        var tracker = new tracking.ColorTracker(['magenta', 'cyan', 'yellow', 'green']);

        tracker.on('track', function(event) {
          event.data.forEach(function(rect) {
            window.plot(rect.x, rect.y, rect.width, rect.height, rect.color).fadeOut(0)
        });
      });

      tracking.track('#video', tracker);

      window.plot = function(x, y, w, h, color) {
        var rect = document.createElement('div.find');
        document.querySelector('.input-container').appendChild(rect);
        rect.classList.add('rect');
        rect.style.border = '7px solid ' + color;
        rect.style.width = w + 'px';
        rect.style.height = h + 'px';
        rect.style.left = (img.offsetLeft + x) + 'px';
        rect.style.top = (img.offsetTop + y) + 'px';
      };
    };

    //Remove the previous rectangles when a new one is created
      function checkExist (){
        //Check how many rectangles exist
        var count = $("div.find").length;

        if (count > 1){
          for (var i = 0; i < count; i++){
            $(".find").eq(i).fadeOut(0)
          }
        }

        $("div.find").fadeOut(0)
      }

    $(document).ready(function(){checkExist()})

  </script>
</body>
</html>